<h1>Welcome to the query</h1>

<div id="new_query_form">
  <%= form_for [Query.new] do |f| %>

    <div>
      <%= f.label "Choose your line:" %><br>
      <%= f.collection_select :route_id1, SubwayRoute.all, :route_id, :display_name %><br>
    </div>

    <div>
      <%= f.label "Choose your starting stop:" %><br>
      <%= f.collection_select :parent_station_id1, @parent_stations1, :stop_id, :stop_name %><br>
    </div>

    <div>
      <%= f.label "Choose your direction*:" %><br>
      <%= f.collection_select :stop_id1, @stops1, :stop_id, :stop_name %><br>
    </div>

    <div>
      <%= f.label "Choose your line:" %><br>
      <%= f.collection_select :route_id2, SubwayRoute.all, :route_id, :display_name %><br>
    </div>

    <div>
      <%= f.label "Choose your starting stop:" %><br>
      <%= f.collection_select :parent_station_id2, @parent_stations2, :stop_id, :stop_name %><br>
    </div>

    <div>
      <%= f.label "Choose your direction*:" %><br>
      <%= f.collection_select :stop_id2, @stops2, :stop_id, :stop_name %><br>
    </div>
    
    <%= f.submit "Find common stops" %>
  <% end %>
</div>

<p>*Don't worry about the final stop, it is the direction that matters</p>

<script>
  $(document).ready(function() {
      $('#query_route_id1').change(function() {
        $.ajax({
          url: "<%= update_parent_stations1_path %>",
          data: {
            route_id : $('#query_route_id1').val()
          },
          dataType: "script"
        });
      });
      $('#query_parent_station_id1').change(function() {
        $.ajax({
          url: "<%= update_headsigns1_path %>",
          data: {
            parent_station_id : $('#query_parent_station_id1').val()
          },
          dataType: "script"
        });
      });
      $('#query_route_id2').change(function() {
        $.ajax({
          url: "<%= update_parent_stations2_path %>",
          data: {
            route_id : $('#query_route_id2').val()
          },
          dataType: "script"
        });
      });
      $('#query_parent_station_id2').change(function() {
        $.ajax({
          url: "<%= update_headsigns2_path %>",
          data: {
            parent_station_id : $('#query_parent_station_id2').val()
          },
          dataType: "script"
        });
      });
    });
</script>